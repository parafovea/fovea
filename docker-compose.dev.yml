# Docker Compose override for development
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
# Or set COMPOSE_FILE=docker-compose.yml:docker-compose.dev.yml

services:
  frontend:
    build:
      target: builder  # Use builder stage for development
    volumes:
      - ./annotation-tool/src:/app/src:ro
      - ./annotation-tool/public:/app/public:ro
    environment:
      - NODE_ENV=development
    command: npm run dev -- --host 0.0.0.0 --port 3000

  backend:
    volumes:
      - ./server/src:/app/src:ro
      - ./server/prisma:/app/prisma:ro
    environment:
      - NODE_ENV=development
    command: npm run dev

  model-service:
    volumes:
      - ./model-service/src:/app/src:ro
    environment:
      - LOG_LEVEL=debug
    command: uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload

  # Add Jaeger for distributed tracing in development
  jaeger:
    image: jaegertracing/all-in-one:latest
    environment:
      - COLLECTOR_OTLP_ENABLED=true
    ports:
      - "16686:16686"  # Jaeger UI
      - "14268:14268"  # Collector HTTP
      - "14250:14250"  # Collector gRPC
    networks:
      - fovea-network
    restart: unless-stopped

  # Development mail catcher for testing email
  maildev:
    image: maildev/maildev:latest
    ports:
      - "1080:1080"  # Web UI
      - "1025:1025"  # SMTP
    networks:
      - fovea-network
    restart: unless-stopped
